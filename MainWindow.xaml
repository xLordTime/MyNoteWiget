<Window x:Class="TaskBarWidget.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Tasks &amp; Notes Widget"
        Height="600" 
        Width="380"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Loaded="Window_Loaded">
    
    <Window.Resources>
        <!-- Slide In Animation -->
        <Storyboard x:Key="SlideInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                           From="400" To="0" Duration="0:0:0.4">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
        
        <!-- Slide Out Animation -->
        <Storyboard x:Key="SlideOutAnimation" Completed="SlideOutAnimation_Completed">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)"
                           From="0" To="400" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="1" To="0" Duration="0:0:0.2"/>
        </Storyboard>

        <!-- Fade In Animation for items -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
    </Window.Resources>
    
    <Border Background="{DynamicResource SecondaryBackgroundBrush}" 
            BorderBrush="{DynamicResource BorderBrush}" 
            BorderThickness="1"
            CornerRadius="16"
            Margin="8"
            x:Name="MainBorder">
        <Border.RenderTransform>
            <TranslateTransform X="0" Y="0"/>
        </Border.RenderTransform>
        <Border.Effect>
            <DropShadowEffect BlurRadius="25" 
                            ShadowDepth="0" 
                            Opacity="0.4" 
                            Color="{Binding Source={StaticResource DarkShadow}, Path=Color}"/>
        </Border.Effect>
        
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“" 
                              FontSize="24" 
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"/>
                    <TextBlock Text="Tasks &amp; Notes" 
                              FontSize="20" 
                              FontWeight="Bold"
                              VerticalAlignment="Center"
                              Foreground="{DynamicResource TextPrimaryBrush}"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="ThemeToggleButton"
                           Content="ðŸŒ™" 
                           Style="{StaticResource IconButton}"
                           Click="ThemeToggleButton_Click"
                           ToolTip="Toggle Dark/Light Mode"
                           Margin="0,0,5,0"/>
                    <Button Content="âž–" 
                           Style="{StaticResource IconButton}"
                           Click="MinimizeButton_Click"
                           ToolTip="Hide Widget"
                           Margin="0,0,5,0"/>
                    <Button Content="âœ–" 
                           Style="{StaticResource IconButton}"
                           Click="CloseButton_Click"
                           ToolTip="Close Widget"/>
                </StackPanel>
            </Grid>

            <!-- Tab Control -->
            <TabControl Grid.Row="1" Grid.RowSpan="2" 
                       BorderThickness="0"
                       Background="Transparent"
                       x:Name="MainTabControl">
                <TabControl.Resources>
                    <Style TargetType="TabItem">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabItem">
                                    <Border x:Name="Border" 
                                           Background="Transparent"
                                           BorderThickness="0"
                                           CornerRadius="8"
                                           Padding="16,10"
                                           Margin="0,0,8,0">
                                        <ContentPresenter ContentSource="Header" 
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" 
                                                   Value="{DynamicResource AccentBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="False">
                                            <Setter Property="Foreground" 
                                                   Value="{DynamicResource TextSecondaryBrush}"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" 
                                                   Value="{DynamicResource HoverBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Resources>
                
                <!-- Tasks Tab -->
                <TabItem FontSize="15" FontWeight="SemiBold">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="âœ“" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Tasks"/>
                        </StackPanel>
                    </TabItem.Header>
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Add Task Section -->
                        <Grid Grid.Row="0" Margin="0,8,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox x:Name="TaskInput" 
                                    Grid.Column="0"
                                    Height="44"
                                    VerticalContentAlignment="Center"
                                    Padding="12,0"
                                    FontSize="14"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="2"
                                    Background="{DynamicResource BackgroundBrush}"
                                    Foreground="{DynamicResource TextPrimaryBrush}"
                                    CaretBrush="{DynamicResource TextPrimaryBrush}"
                                    KeyDown="TaskInput_KeyDown">
                                <TextBox.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </TextBox.Resources>
                            </TextBox>
                            
                            <Button Grid.Column="1" 
                                   Content="âž•"
                                   Width="44"
                                   Height="44"
                                   Margin="10,0,0,0"
                                   Style="{StaticResource ModernButton}"
                                   FontSize="20"
                                   Click="AddTask_Click"/>
                        </Grid>

                        <!-- Tasks List -->
                        <ScrollViewer Grid.Row="1" 
                                    VerticalScrollBarVisibility="Auto"
                                    Background="{DynamicResource BackgroundBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="2"
                                    Padding="8"
                                    CanContentScroll="True">
                            <ScrollViewer.Resources>
                                <Style TargetType="ScrollBar">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Width" Value="8"/>
                                </Style>
                            </ScrollViewer.Resources>
                            <Border CornerRadius="8">
                                <ItemsControl x:Name="TasksList" Margin="0">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <!-- Main Task -->
                                                <Border Background="{DynamicResource SecondaryBackgroundBrush}"
                                                       BorderBrush="{DynamicResource BorderBrush}" 
                                                       BorderThickness="0" 
                                                       Padding="12"
                                                       Margin="0,0,0,8"
                                                       CornerRadius="10"
                                                       x:Name="TaskBorder">
                                                    <Border.ContextMenu>
                                                        <ContextMenu>
                                                            <MenuItem Header="âœï¸ Bearbeiten" 
                                                                     Click="EditTask_Click"
                                                                     Tag="{Binding}"/>
                                                            <Separator/>
                                                            <MenuItem Header="âž• Unteraufgabe hinzufÃ¼gen" 
                                                                     Click="AddSubTask_Click"
                                                                     Tag="{Binding}"/>
                                                            <MenuItem Header="ðŸ“ Unteraufgaben ein-/ausklappen" 
                                                                     Click="ToggleSubTasks_Click"
                                                                     Tag="{Binding}">
                                                                <MenuItem.Style>
                                                                    <Style TargetType="MenuItem">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding HasSubTasks}" Value="False">
                                                                                <Setter Property="IsEnabled" Value="False"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </MenuItem.Style>
                                                            </MenuItem>
                                                        </ContextMenu>
                                                    </Border.ContextMenu>
                                                    <Border.Triggers>
                                                        <EventTrigger RoutedEvent="Loaded">
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                   From="0" To="1" Duration="0:0:0.3"/>
                                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                                                                   From="20" To="0" Duration="0:0:0.3">
                                                                        <DoubleAnimation.EasingFunction>
                                                                            <CubicEase EasingMode="EaseOut"/>
                                                                        </DoubleAnimation.EasingFunction>
                                                                    </DoubleAnimation>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                    </Border.Triggers>
                                                    <Border.RenderTransform>
                                                        <TranslateTransform Y="0"/>
                                                    </Border.RenderTransform>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <!-- Expand/Collapse Button -->
                                                        <Button Grid.Column="0"
                                                               Content="â–¼"
                                                               Width="20"
                                                               Height="20"
                                                               FontSize="10"
                                                               Background="Transparent"
                                                               BorderThickness="0"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,5,0"
                                                               Cursor="Hand"
                                                               Click="ToggleSubTasks_Click"
                                                               Tag="{Binding}"
                                                               x:Name="ExpandButton">
                                                            <Button.Style>
                                                                <Style TargetType="Button">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding HasSubTasks}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding IsExpanded}" Value="False">
                                                                            <Setter Property="Content" Value="â–¶"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Button.Style>
                                                        </Button>
                                                        
                                                        <CheckBox Grid.Column="1" 
                                                                 IsChecked="{Binding IsCompleted}"
                                                                 VerticalAlignment="Center"
                                                                 Margin="0,0,12,0"
                                                                 Style="{StaticResource ModernCheckBox}"
                                                                 Checked="TaskCheckBox_Changed"
                                                                 Unchecked="TaskCheckBox_Changed"/>
                                                        
                                                        <TextBlock Grid.Column="2" 
                                                                  Text="{Binding Text}"
                                                                  TextWrapping="Wrap"
                                                                  VerticalAlignment="Center"
                                                                  FontSize="14"
                                                                  Foreground="{DynamicResource TextPrimaryBrush}">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                                            <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                                            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                                            <Setter Property="Opacity" Value="0.6"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        
                                                        <Button Grid.Column="3"
                                                               Content="ðŸ—‘"
                                                               Style="{StaticResource IconButton}"
                                                               Width="32"
                                                               Height="32"
                                                               FontSize="14"
                                                               Click="DeleteTask_Click"
                                                               Opacity="0.6"
                                                               Tag="{Binding}">
                                                            <Button.Triggers>
                                                                <EventTrigger RoutedEvent="MouseEnter">
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                           To="1" Duration="0:0:0.2"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </EventTrigger>
                                                                <EventTrigger RoutedEvent="MouseLeave">
                                                                    <BeginStoryboard>
                                                                        <Storyboard>
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                           To="0.6" Duration="0:0:0.2"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </EventTrigger>
                                                            </Button.Triggers>
                                                        </Button>
                                                    </Grid>
                                                </Border>
                                                
                                                <!-- SubTasks -->
                                                <ItemsControl ItemsSource="{Binding SubTasks}" 
                                                             Margin="30,0,0,0">
                                                    <ItemsControl.Style>
                                                        <Style TargetType="ItemsControl">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition Binding="{Binding HasSubTasks}" Value="True"/>
                                                                        <Condition Binding="{Binding IsExpanded}" Value="True"/>
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </MultiDataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ItemsControl.Style>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="{DynamicResource BackgroundBrush}"
                                                                   BorderBrush="{DynamicResource BorderBrush}" 
                                                                   BorderThickness="1,0,0,0" 
                                                                   Padding="12,8"
                                                                   Margin="0,0,0,6"
                                                                   CornerRadius="0,8,8,0">
                                                                <Border.ContextMenu>
                                                                    <ContextMenu>
                                                                        <MenuItem Header="âœï¸ Bearbeiten" 
                                                                                 Click="EditTask_Click"
                                                                                 Tag="{Binding}"/>
                                                                    </ContextMenu>
                                                                </Border.ContextMenu>
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <CheckBox Grid.Column="0" 
                                                                             IsChecked="{Binding IsCompleted}"
                                                                             VerticalAlignment="Center"
                                                                             Margin="0,0,10,0"
                                                                             Style="{StaticResource ModernCheckBox}"
                                                                             Checked="TaskCheckBox_Changed"
                                                                             Unchecked="TaskCheckBox_Changed"/>
                                                                    
                                                                    <TextBlock Grid.Column="1" 
                                                                              Text="{Binding Text}"
                                                                              TextWrapping="Wrap"
                                                                              VerticalAlignment="Center"
                                                                              FontSize="13"
                                                                              Foreground="{DynamicResource TextSecondaryBrush}">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                                                        <Setter Property="Opacity" Value="0.5"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                    
                                                                    <Button Grid.Column="2"
                                                                           Content="ðŸ—‘"
                                                                           Style="{StaticResource IconButton}"
                                                                           Width="28"
                                                                           Height="28"
                                                                           FontSize="12"
                                                                           Click="DeleteTask_Click"
                                                                           Opacity="0.5"
                                                                           Tag="{Binding}"/>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </ScrollViewer>

                        <!-- Task Counter -->
                        <Border Grid.Row="2" 
                               Background="{DynamicResource HoverBrush}"
                               CornerRadius="8"
                               Padding="12,8"
                               Margin="0,10,0,0">
                            <TextBlock x:Name="TaskCounter"
                                      FontSize="12"
                                      FontWeight="SemiBold"
                                      Foreground="{DynamicResource TextSecondaryBrush}"
                                      HorizontalAlignment="Center"/>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- Notes Tab -->
                <TabItem FontSize="15" FontWeight="SemiBold">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“„" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Notes"/>
                        </StackPanel>
                    </TabItem.Header>
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Notes TextBox -->
                        <Border Grid.Row="0"
                               Background="{DynamicResource BackgroundBrush}"
                               BorderBrush="{DynamicResource BorderBrush}"
                               BorderThickness="2"
                               CornerRadius="10">
                            <TextBox x:Name="NotesTextBox"
                                    AcceptsReturn="True"
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto"
                                    Padding="15"
                                    FontSize="14"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Foreground="{DynamicResource TextPrimaryBrush}"
                                    CaretBrush="{DynamicResource TextPrimaryBrush}"
                                    TextChanged="NotesTextBox_TextChanged"/>
                        </Border>

                        <!-- Save Indicator -->
                        <Border Grid.Row="1"
                               Background="{DynamicResource HoverBrush}"
                               CornerRadius="8"
                               Padding="12,8"
                               Margin="0,10,0,0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="ðŸ’¾ " FontSize="12" VerticalAlignment="Center"/>
                                <TextBlock x:Name="SaveIndicator"
                                          FontSize="12"
                                          FontWeight="SemiBold"
                                          Foreground="{DynamicResource TextSecondaryBrush}"
                                          Text="Saved"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Border>
</Window>
